{"id":"rnlf","dependencies":[{"name":"/Users/orestes/code/open-source/spotify-web-watcher/package.json","includedInParent":true,"mtime":1588799788042},{"name":"../config","loc":{"line":1,"column":21},"parent":"/Users/orestes/code/open-source/spotify-web-watcher/src/content-handler.js","resolved":"/Users/orestes/code/open-source/spotify-web-watcher/config.js"},{"name":"firebase/app","loc":{"line":2,"column":26},"parent":"/Users/orestes/code/open-source/spotify-web-watcher/src/content-handler.js","resolved":"/Users/orestes/code/open-source/spotify-web-watcher/node_modules/firebase/app/dist/index.cjs.js"},{"name":"firebase/auth","loc":{"line":3,"column":7},"parent":"/Users/orestes/code/open-source/spotify-web-watcher/src/content-handler.js","resolved":"/Users/orestes/code/open-source/spotify-web-watcher/node_modules/firebase/auth/dist/index.esm.js"},{"name":"firebase/firestore","loc":{"line":4,"column":7},"parent":"/Users/orestes/code/open-source/spotify-web-watcher/src/content-handler.js","resolved":"/Users/orestes/code/open-source/spotify-web-watcher/node_modules/firebase/firestore/dist/index.esm.js"},{"name":"./utils","loc":{"line":5,"column":29},"parent":"/Users/orestes/code/open-source/spotify-web-watcher/src/content-handler.js","resolved":"/Users/orestes/code/open-source/spotify-web-watcher/src/utils.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.ContentHandler=void 0;var e=require(\"../config\"),t=n(require(\"firebase/app\"));require(\"firebase/auth\"),require(\"firebase/firestore\");var r=require(\"./utils\");function i(){if(\"function\"!=typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}function n(e){if(e&&e.__esModule)return e;if(null===e||\"object\"!=typeof e&&\"function\"!=typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var o=n?Object.getOwnPropertyDescriptor(e,s):null;o&&(o.get||o.set)?Object.defineProperty(r,s,o):r[s]=e[s]}return r.default=e,t&&t.set(e,r),r}class s{constructor(){this.userId=void 0,this.pendingUpdates={},this.updateTrigger=void 0}async watchForChanges(e,t){const r=new MutationObserver(function(e){for(let r of e)\"childList\"===r.type?console.log(\"A child node has been added or removed.\"):\"attributes\"===r.type&&(console.log(\"The \"+r.attributeName+\" attribute was modified.\"),t())});return r.observe(e,{attributes:!0,characterData:!0,childList:!0,subtree:!1}),()=>{r.disconnect()}}getCoverElement(){return document.querySelector(\".cover-art-image\")}getSongElement(){return document.querySelector(\"[data-testid=nowplaying-track-link]\")}getArtistElement(){return document.querySelector('a[href^=\"/artist\"]')}getCover(){return this.getCoverElement().src}getSong(){return this.getSongElement().innerText}getArtist(){return this.getArtistElement().innerText}async publishPendingUpdates(){this.pendingUpdates.version=e.config.version,this.pendingUpdates.date=t.firestore.Timestamp.now(),await t.firestore().collection(\"users\").doc(this.userId).set(this.pendingUpdates,{merge:!0})}updateNowPlaying(t){this.pendingUpdates={...this.pendingUpdates,...t},this.updateTrigger&&clearTimeout(this.updateTrigger),this.updateTrigger=setTimeout(()=>{this.publishPendingUpdates()},e.config.debounceTime)}initFirebase(){t.initializeApp(e.config.firebase)}async getCurrentUserId(){const{user:e}=await t.auth().signInAnonymously();return e.uid}async run(){this.initFirebase(),this.userId=await this.getCurrentUserId(),await(0,r.setStoredValue)({[e.config.storageKey]:this.userId}),console.log(\"Current user\",this.userId);const t={cover:this.getCover(),song:this.getSong(),artist:this.getArtist()};console.log(\"Now playing\",t),await this.watchForChanges(this.getCoverElement(),()=>{this.updateNowPlaying({cover:this.getCover()})}),await this.watchForChanges(this.getSongElement(),()=>{this.updateNowPlaying({song:this.getSong()})}),await this.watchForChanges(this.getArtistElement(),()=>{this.updateNowPlaying({artist:this.getArtist()})}),await this.updateNowPlaying(t),console.log(`Spotify Watcher ${e.config.version} loaded`)}}exports.ContentHandler=s;"},"sourceMaps":{"js":{"mappings":[{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":0}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":13}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":20}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":35}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":43}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":56}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":57}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":64}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":68}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":76}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":96}},{"source":"content-handler.js","original":{"line":1,"column":0},"generated":{"line":1,"column":98}},{"source":"content-handler.js","original":{"line":1,"column":0},"generated":{"line":1,"column":102}},{"source":"content-handler.js","original":{"line":1,"column":0},"generated":{"line":1,"column":104}},{"source":"content-handler.js","original":{"line":1,"column":0},"generated":{"line":1,"column":112}},{"source":"content-handler.js","original":{"line":2,"column":0},"generated":{"line":1,"column":125}},{"source":"content-handler.js","original":{"line":2,"column":0},"generated":{"line":1,"column":127}},{"source":"content-handler.js","original":{"line":2,"column":0},"generated":{"line":1,"column":129}},{"source":"content-handler.js","original":{"line":2,"column":0},"generated":{"line":1,"column":137}},{"source":"content-handler.js","original":{"line":3,"column":0},"generated":{"line":1,"column":154}},{"source":"content-handler.js","original":{"line":3,"column":0},"generated":{"line":1,"column":162}},{"source":"content-handler.js","original":{"line":4,"column":0},"generated":{"line":1,"column":179}},{"source":"content-handler.js","original":{"line":4,"column":0},"generated":{"line":1,"column":187}},{"source":"content-handler.js","original":{"line":5,"column":0},"generated":{"line":1,"column":209}},{"source":"content-handler.js","original":{"line":5,"column":0},"generated":{"line":1,"column":213}},{"source":"content-handler.js","original":{"line":5,"column":0},"generated":{"line":1,"column":215}},{"source":"content-handler.js","original":{"line":5,"column":0},"generated":{"line":1,"column":223}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":234}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":243}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":247}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":250}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":269}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":277}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":284}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":289}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":293}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":295}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":299}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":307}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":314}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":316}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":327}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":334}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":337}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":339}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":348}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":350}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":353}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":356}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":359}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":361}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":372}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":379}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":381}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":384}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":391}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":394}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":411}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":414}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":433}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":435}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":441}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":442}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":450}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":453}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":457}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":459}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":463}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":466}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":469}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":471}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":475}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":478}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":485}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":487}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":491}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":494}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":498}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":500}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":503}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":505}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":512}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":528}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":535}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":560}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":564}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":568}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":573}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":575}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":578}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":585}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":595}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":610}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":615}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":617}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":620}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":621}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":625}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":627}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":629}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":636}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":661}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":663}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":666}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":671}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":675}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":677}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":682}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":684}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":689}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":696}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":711}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":713}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":715}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":718}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":720}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":723}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":725}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":728}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":735}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":737}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":745}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":747}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":750}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":752}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":756}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":758}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":761}},{"source":"content-handler.js","original":{"line":7,"column":7},"generated":{"line":1,"column":763}},{"source":"content-handler.js","name":"ContentHandler","original":{"line":7,"column":13},"generated":{"line":1,"column":769}},{"source":"content-handler.js","name":"constructor","original":{"line":9,"column":4},"generated":{"line":1,"column":771}},{"source":"content-handler.js","name":"userId","original":{"line":10,"column":13},"generated":{"line":1,"column":785}},{"source":"content-handler.js","name":"userId","original":{"line":10,"column":13},"generated":{"line":1,"column":790}},{"source":"content-handler.js","name":"undefined","original":{"line":10,"column":22},"generated":{"line":1,"column":802}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":11,"column":13},"generated":{"line":1,"column":804}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":11,"column":13},"generated":{"line":1,"column":809}},{"source":"content-handler.js","original":{"line":11,"column":30},"generated":{"line":1,"column":824}},{"source":"content-handler.js","name":"updateTrigger","original":{"line":12,"column":13},"generated":{"line":1,"column":827}},{"source":"content-handler.js","name":"updateTrigger","original":{"line":12,"column":13},"generated":{"line":1,"column":832}},{"source":"content-handler.js","name":"undefined","original":{"line":12,"column":29},"generated":{"line":1,"column":851}},{"source":"content-handler.js","name":"watchForChanges","original":{"line":15,"column":10},"generated":{"line":1,"column":853}},{"source":"content-handler.js","name":"element","original":{"line":15,"column":26},"generated":{"line":1,"column":875}},{"source":"content-handler.js","name":"callback","original":{"line":15,"column":35},"generated":{"line":1,"column":877}},{"source":"content-handler.js","name":"config","original":{"line":17,"column":14},"generated":{"line":1,"column":880}},{"source":"content-handler.js","name":"observer","original":{"line":20,"column":14},"generated":{"line":1,"column":886}},{"source":"content-handler.js","original":{"line":20,"column":25},"generated":{"line":1,"column":888}},{"source":"content-handler.js","name":"MutationObserver","original":{"line":20,"column":29},"generated":{"line":1,"column":892}},{"source":"content-handler.js","original":{"line":20,"column":46},"generated":{"line":1,"column":909}},{"source":"content-handler.js","name":"mutationsList","original":{"line":20,"column":56},"generated":{"line":1,"column":918}},{"source":"content-handler.js","original":{"line":22,"column":17},"generated":{"line":1,"column":921}},{"source":"content-handler.js","original":{"line":22,"column":17},"generated":{"line":1,"column":925}},{"source":"content-handler.js","name":"mutation","original":{"line":22,"column":21},"generated":{"line":1,"column":929}},{"source":"content-handler.js","name":"mutationsList","original":{"line":22,"column":33},"generated":{"line":1,"column":934}},{"source":"content-handler.js","original":{"line":23,"column":38},"generated":{"line":1,"column":936}},{"source":"content-handler.js","name":"mutation","original":{"line":23,"column":20},"generated":{"line":1,"column":950}},{"source":"content-handler.js","name":"type","original":{"line":23,"column":29},"generated":{"line":1,"column":952}},{"source":"content-handler.js","name":"console","original":{"line":24,"column":20},"generated":{"line":1,"column":957}},{"source":"content-handler.js","name":"log","original":{"line":24,"column":28},"generated":{"line":1,"column":965}},{"source":"content-handler.js","original":{"line":24,"column":32},"generated":{"line":1,"column":969}},{"source":"content-handler.js","original":{"line":25,"column":45},"generated":{"line":1,"column":1012}},{"source":"content-handler.js","name":"mutation","original":{"line":25,"column":27},"generated":{"line":1,"column":1027}},{"source":"content-handler.js","name":"type","original":{"line":25,"column":36},"generated":{"line":1,"column":1029}},{"source":"content-handler.js","name":"console","original":{"line":26,"column":20},"generated":{"line":1,"column":1036}},{"source":"content-handler.js","name":"log","original":{"line":26,"column":28},"generated":{"line":1,"column":1044}},{"source":"content-handler.js","original":{"line":26,"column":32},"generated":{"line":1,"column":1048}},{"source":"content-handler.js","name":"mutation","original":{"line":26,"column":41},"generated":{"line":1,"column":1055}},{"source":"content-handler.js","name":"attributeName","original":{"line":26,"column":50},"generated":{"line":1,"column":1057}},{"source":"content-handler.js","original":{"line":26,"column":66},"generated":{"line":1,"column":1071}},{"source":"content-handler.js","name":"callback","original":{"line":27,"column":20},"generated":{"line":1,"column":1099}},{"source":"content-handler.js","original":{"line":35,"column":15},"generated":{"line":1,"column":1106}},{"source":"content-handler.js","name":"observer","original":{"line":33,"column":8},"generated":{"line":1,"column":1113}},{"source":"content-handler.js","name":"observe","original":{"line":33,"column":17},"generated":{"line":1,"column":1115}},{"source":"content-handler.js","name":"element","original":{"line":33,"column":25},"generated":{"line":1,"column":1123}},{"source":"content-handler.js","original":{"line":17,"column":23},"generated":{"line":1,"column":1125}},{"source":"content-handler.js","name":"attributes","original":{"line":17,"column":24},"generated":{"line":1,"column":1126}},{"source":"content-handler.js","original":{"line":17,"column":36},"generated":{"line":1,"column":1138}},{"source":"content-handler.js","name":"characterData","original":{"line":17,"column":42},"generated":{"line":1,"column":1140}},{"source":"content-handler.js","original":{"line":17,"column":57},"generated":{"line":1,"column":1155}},{"source":"content-handler.js","name":"childList","original":{"line":17,"column":63},"generated":{"line":1,"column":1157}},{"source":"content-handler.js","original":{"line":17,"column":74},"generated":{"line":1,"column":1168}},{"source":"content-handler.js","name":"subtree","original":{"line":17,"column":80},"generated":{"line":1,"column":1170}},{"source":"content-handler.js","original":{"line":17,"column":89},"generated":{"line":1,"column":1179}},{"source":"content-handler.js","original":{"line":35,"column":15},"generated":{"line":1,"column":1183}},{"source":"content-handler.js","name":"observer","original":{"line":36,"column":12},"generated":{"line":1,"column":1188}},{"source":"content-handler.js","name":"disconnect","original":{"line":36,"column":21},"generated":{"line":1,"column":1190}},{"source":"content-handler.js","name":"getCoverElement","original":{"line":40,"column":4},"generated":{"line":1,"column":1204}},{"source":"content-handler.js","name":"document","original":{"line":41,"column":15},"generated":{"line":1,"column":1222}},{"source":"content-handler.js","name":"document","original":{"line":41,"column":15},"generated":{"line":1,"column":1229}},{"source":"content-handler.js","name":"querySelector","original":{"line":41,"column":24},"generated":{"line":1,"column":1238}},{"source":"content-handler.js","original":{"line":41,"column":38},"generated":{"line":1,"column":1252}},{"source":"content-handler.js","name":"getSongElement","original":{"line":44,"column":4},"generated":{"line":1,"column":1272}},{"source":"content-handler.js","name":"document","original":{"line":45,"column":15},"generated":{"line":1,"column":1289}},{"source":"content-handler.js","name":"document","original":{"line":45,"column":15},"generated":{"line":1,"column":1296}},{"source":"content-handler.js","name":"querySelector","original":{"line":45,"column":24},"generated":{"line":1,"column":1305}},{"source":"content-handler.js","original":{"line":45,"column":38},"generated":{"line":1,"column":1319}},{"source":"content-handler.js","name":"getArtistElement","original":{"line":48,"column":4},"generated":{"line":1,"column":1358}},{"source":"content-handler.js","name":"document","original":{"line":49,"column":15},"generated":{"line":1,"column":1377}},{"source":"content-handler.js","name":"document","original":{"line":49,"column":15},"generated":{"line":1,"column":1384}},{"source":"content-handler.js","name":"querySelector","original":{"line":49,"column":24},"generated":{"line":1,"column":1393}},{"source":"content-handler.js","original":{"line":49,"column":38},"generated":{"line":1,"column":1407}},{"source":"content-handler.js","name":"getCover","original":{"line":52,"column":4},"generated":{"line":1,"column":1429}},{"source":"content-handler.js","original":{"line":53,"column":15},"generated":{"line":1,"column":1440}},{"source":"content-handler.js","original":{"line":53,"column":15},"generated":{"line":1,"column":1447}},{"source":"content-handler.js","name":"getCoverElement","original":{"line":53,"column":20},"generated":{"line":1,"column":1452}},{"source":"content-handler.js","name":"src","original":{"line":53,"column":38},"generated":{"line":1,"column":1470}},{"source":"content-handler.js","name":"getSong","original":{"line":56,"column":4},"generated":{"line":1,"column":1474}},{"source":"content-handler.js","original":{"line":57,"column":15},"generated":{"line":1,"column":1484}},{"source":"content-handler.js","original":{"line":57,"column":15},"generated":{"line":1,"column":1491}},{"source":"content-handler.js","name":"getSongElement","original":{"line":57,"column":20},"generated":{"line":1,"column":1496}},{"source":"content-handler.js","name":"innerText","original":{"line":57,"column":37},"generated":{"line":1,"column":1513}},{"source":"content-handler.js","name":"getArtist","original":{"line":60,"column":4},"generated":{"line":1,"column":1523}},{"source":"content-handler.js","original":{"line":61,"column":15},"generated":{"line":1,"column":1535}},{"source":"content-handler.js","original":{"line":61,"column":15},"generated":{"line":1,"column":1542}},{"source":"content-handler.js","name":"getArtistElement","original":{"line":61,"column":20},"generated":{"line":1,"column":1547}},{"source":"content-handler.js","name":"innerText","original":{"line":61,"column":39},"generated":{"line":1,"column":1566}},{"source":"content-handler.js","name":"publishPendingUpdates","original":{"line":64,"column":10},"generated":{"line":1,"column":1576}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":65,"column":13},"generated":{"line":1,"column":1606}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":65,"column":13},"generated":{"line":1,"column":1611}},{"source":"content-handler.js","name":"version","original":{"line":65,"column":28},"generated":{"line":1,"column":1626}},{"source":"content-handler.js","name":"config","original":{"line":65,"column":38},"generated":{"line":1,"column":1634}},{"source":"content-handler.js","name":"version","original":{"line":65,"column":45},"generated":{"line":1,"column":1636}},{"source":"content-handler.js","name":"version","original":{"line":65,"column":45},"generated":{"line":1,"column":1643}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":66,"column":13},"generated":{"line":1,"column":1651}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":66,"column":13},"generated":{"line":1,"column":1656}},{"source":"content-handler.js","name":"date","original":{"line":66,"column":28},"generated":{"line":1,"column":1671}},{"source":"content-handler.js","name":"firebase","original":{"line":66,"column":35},"generated":{"line":1,"column":1676}},{"source":"content-handler.js","name":"firestore","original":{"line":66,"column":44},"generated":{"line":1,"column":1678}},{"source":"content-handler.js","name":"Timestamp","original":{"line":66,"column":54},"generated":{"line":1,"column":1688}},{"source":"content-handler.js","name":"now","original":{"line":66,"column":64},"generated":{"line":1,"column":1698}},{"source":"content-handler.js","name":"firebase","original":{"line":67,"column":14},"generated":{"line":1,"column":1710}},{"source":"content-handler.js","name":"firestore","original":{"line":67,"column":23},"generated":{"line":1,"column":1712}},{"source":"content-handler.js","name":"collection","original":{"line":67,"column":35},"generated":{"line":1,"column":1724}},{"source":"content-handler.js","original":{"line":67,"column":47},"generated":{"line":1,"column":1735}},{"source":"content-handler.js","name":"doc","original":{"line":67,"column":55},"generated":{"line":1,"column":1744}},{"source":"content-handler.js","original":{"line":67,"column":59},"generated":{"line":1,"column":1748}},{"source":"content-handler.js","name":"userId","original":{"line":67,"column":64},"generated":{"line":1,"column":1753}},{"source":"content-handler.js","name":"set","original":{"line":67,"column":72},"generated":{"line":1,"column":1761}},{"source":"content-handler.js","original":{"line":67,"column":76},"generated":{"line":1,"column":1765}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":67,"column":81},"generated":{"line":1,"column":1770}},{"source":"content-handler.js","original":{"line":67,"column":97},"generated":{"line":1,"column":1785}},{"source":"content-handler.js","name":"merge","original":{"line":67,"column":98},"generated":{"line":1,"column":1786}},{"source":"content-handler.js","original":{"line":67,"column":105},"generated":{"line":1,"column":1793}},{"source":"content-handler.js","name":"updateNowPlaying","original":{"line":70,"column":4},"generated":{"line":1,"column":1797}},{"source":"content-handler.js","name":"data","original":{"line":70,"column":21},"generated":{"line":1,"column":1814}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":72,"column":13},"generated":{"line":1,"column":1817}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":72,"column":13},"generated":{"line":1,"column":1822}},{"source":"content-handler.js","original":{"line":72,"column":30},"generated":{"line":1,"column":1837}},{"source":"content-handler.js","original":{"line":72,"column":34},"generated":{"line":1,"column":1841}},{"source":"content-handler.js","name":"pendingUpdates","original":{"line":72,"column":39},"generated":{"line":1,"column":1846}},{"source":"content-handler.js","name":"data","original":{"line":72,"column":58},"generated":{"line":1,"column":1864}},{"source":"content-handler.js","original":{"line":73,"column":12},"generated":{"line":1,"column":1867}},{"source":"content-handler.js","name":"updateTrigger","original":{"line":73,"column":17},"generated":{"line":1,"column":1872}},{"source":"content-handler.js","name":"clearTimeout","original":{"line":74,"column":12},"generated":{"line":1,"column":1887}},{"source":"content-handler.js","original":{"line":74,"column":25},"generated":{"line":1,"column":1900}},{"source":"content-handler.js","name":"updateTrigger","original":{"line":74,"column":30},"generated":{"line":1,"column":1905}},{"source":"content-handler.js","name":"updateTrigger","original":{"line":77,"column":13},"generated":{"line":1,"column":1920}},{"source":"content-handler.js","name":"updateTrigger","original":{"line":77,"column":13},"generated":{"line":1,"column":1925}},{"source":"content-handler.js","name":"setTimeout","original":{"line":77,"column":29},"generated":{"line":1,"column":1939}},{"source":"content-handler.js","original":{"line":77,"column":40},"generated":{"line":1,"column":1950}},{"source":"content-handler.js","name":"publishPendingUpdates","original":{"line":78,"column":17},"generated":{"line":1,"column":1955}},{"source":"content-handler.js","name":"publishPendingUpdates","original":{"line":78,"column":17},"generated":{"line":1,"column":1960}},{"source":"content-handler.js","name":"config","original":{"line":79,"column":11},"generated":{"line":1,"column":1985}},{"source":"content-handler.js","name":"debounceTime","original":{"line":79,"column":18},"generated":{"line":1,"column":1987}},{"source":"content-handler.js","name":"debounceTime","original":{"line":79,"column":18},"generated":{"line":1,"column":1994}},{"source":"content-handler.js","name":"initFirebase","original":{"line":82,"column":4},"generated":{"line":1,"column":2008}},{"source":"content-handler.js","name":"firebase","original":{"line":83,"column":8},"generated":{"line":1,"column":2023}},{"source":"content-handler.js","name":"initializeApp","original":{"line":83,"column":17},"generated":{"line":1,"column":2025}},{"source":"content-handler.js","name":"config","original":{"line":83,"column":31},"generated":{"line":1,"column":2039}},{"source":"content-handler.js","name":"firebase","original":{"line":83,"column":38},"generated":{"line":1,"column":2041}},{"source":"content-handler.js","name":"firebase","original":{"line":83,"column":38},"generated":{"line":1,"column":2048}},{"source":"content-handler.js","name":"getCurrentUserId","original":{"line":86,"column":10},"generated":{"line":1,"column":2058}},{"source":"content-handler.js","original":{"line":87,"column":14},"generated":{"line":1,"column":2083}},{"source":"content-handler.js","original":{"line":87,"column":14},"generated":{"line":1,"column":2089}},{"source":"content-handler.js","name":"user","original":{"line":87,"column":15},"generated":{"line":1,"column":2094}},{"source":"content-handler.js","name":"firebase","original":{"line":87,"column":29},"generated":{"line":1,"column":2103}},{"source":"content-handler.js","name":"auth","original":{"line":87,"column":38},"generated":{"line":1,"column":2105}},{"source":"content-handler.js","name":"signInAnonymously","original":{"line":87,"column":45},"generated":{"line":1,"column":2112}},{"source":"content-handler.js","name":"user","original":{"line":88,"column":15},"generated":{"line":1,"column":2132}},{"source":"content-handler.js","name":"user","original":{"line":88,"column":15},"generated":{"line":1,"column":2139}},{"source":"content-handler.js","name":"uid","original":{"line":88,"column":20},"generated":{"line":1,"column":2141}},{"source":"content-handler.js","name":"run","original":{"line":91,"column":10},"generated":{"line":1,"column":2145}},{"source":"content-handler.js","name":"initFirebase","original":{"line":92,"column":13},"generated":{"line":1,"column":2157}},{"source":"content-handler.js","name":"initFirebase","original":{"line":92,"column":13},"generated":{"line":1,"column":2162}},{"source":"content-handler.js","name":"userId","original":{"line":93,"column":13},"generated":{"line":1,"column":2177}},{"source":"content-handler.js","name":"userId","original":{"line":93,"column":13},"generated":{"line":1,"column":2182}},{"source":"content-handler.js","original":{"line":93,"column":28},"generated":{"line":1,"column":2195}},{"source":"content-handler.js","name":"getCurrentUserId","original":{"line":93,"column":33},"generated":{"line":1,"column":2200}},{"source":"content-handler.js","original":{"line":95,"column":14},"generated":{"line":1,"column":2225}},{"source":"content-handler.js","original":{"line":95,"column":29},"generated":{"line":1,"column":2227}},{"source":"content-handler.js","original":{"line":95,"column":29},"generated":{"line":1,"column":2229}},{"source":"content-handler.js","original":{"line":95,"column":29},"generated":{"line":1,"column":2245}},{"source":"content-handler.js","name":"config","original":{"line":95,"column":31},"generated":{"line":1,"column":2246}},{"source":"content-handler.js","name":"config","original":{"line":95,"column":31},"generated":{"line":1,"column":2247}},{"source":"content-handler.js","name":"storageKey","original":{"line":95,"column":38},"generated":{"line":1,"column":2249}},{"source":"content-handler.js","name":"storageKey","original":{"line":95,"column":38},"generated":{"line":1,"column":2256}},{"source":"content-handler.js","original":{"line":95,"column":51},"generated":{"line":1,"column":2268}},{"source":"content-handler.js","name":"userId","original":{"line":95,"column":56},"generated":{"line":1,"column":2273}},{"source":"content-handler.js","name":"console","original":{"line":97,"column":8},"generated":{"line":1,"column":2282}},{"source":"content-handler.js","name":"log","original":{"line":97,"column":16},"generated":{"line":1,"column":2290}},{"source":"content-handler.js","original":{"line":97,"column":20},"generated":{"line":1,"column":2294}},{"source":"content-handler.js","original":{"line":97,"column":36},"generated":{"line":1,"column":2309}},{"source":"content-handler.js","name":"userId","original":{"line":97,"column":41},"generated":{"line":1,"column":2314}},{"source":"content-handler.js","name":"data","original":{"line":99,"column":14},"generated":{"line":1,"column":2322}},{"source":"content-handler.js","name":"data","original":{"line":99,"column":14},"generated":{"line":1,"column":2328}},{"source":"content-handler.js","original":{"line":99,"column":21},"generated":{"line":1,"column":2330}},{"source":"content-handler.js","name":"cover","original":{"line":100,"column":12},"generated":{"line":1,"column":2331}},{"source":"content-handler.js","original":{"line":100,"column":19},"generated":{"line":1,"column":2337}},{"source":"content-handler.js","name":"getCover","original":{"line":100,"column":24},"generated":{"line":1,"column":2342}},{"source":"content-handler.js","name":"song","original":{"line":101,"column":12},"generated":{"line":1,"column":2353}},{"source":"content-handler.js","original":{"line":101,"column":18},"generated":{"line":1,"column":2358}},{"source":"content-handler.js","name":"getSong","original":{"line":101,"column":23},"generated":{"line":1,"column":2363}},{"source":"content-handler.js","name":"artist","original":{"line":102,"column":12},"generated":{"line":1,"column":2373}},{"source":"content-handler.js","original":{"line":102,"column":20},"generated":{"line":1,"column":2380}},{"source":"content-handler.js","name":"getArtist","original":{"line":102,"column":25},"generated":{"line":1,"column":2385}},{"source":"content-handler.js","name":"console","original":{"line":105,"column":8},"generated":{"line":1,"column":2398}},{"source":"content-handler.js","name":"log","original":{"line":105,"column":16},"generated":{"line":1,"column":2406}},{"source":"content-handler.js","original":{"line":105,"column":20},"generated":{"line":1,"column":2410}},{"source":"content-handler.js","name":"data","original":{"line":105,"column":35},"generated":{"line":1,"column":2424}},{"source":"content-handler.js","original":{"line":107,"column":14},"generated":{"line":1,"column":2433}},{"source":"content-handler.js","name":"watchForChanges","original":{"line":107,"column":19},"generated":{"line":1,"column":2438}},{"source":"content-handler.js","original":{"line":107,"column":35},"generated":{"line":1,"column":2454}},{"source":"content-handler.js","name":"getCoverElement","original":{"line":107,"column":40},"generated":{"line":1,"column":2459}},{"source":"content-handler.js","original":{"line":107,"column":59},"generated":{"line":1,"column":2477}},{"source":"content-handler.js","name":"updateNowPlaying","original":{"line":108,"column":17},"generated":{"line":1,"column":2482}},{"source":"content-handler.js","name":"updateNowPlaying","original":{"line":108,"column":17},"generated":{"line":1,"column":2487}},{"source":"content-handler.js","original":{"line":108,"column":34},"generated":{"line":1,"column":2504}},{"source":"content-handler.js","name":"cover","original":{"line":108,"column":35},"generated":{"line":1,"column":2505}},{"source":"content-handler.js","original":{"line":108,"column":42},"generated":{"line":1,"column":2511}},{"source":"content-handler.js","name":"getCover","original":{"line":108,"column":47},"generated":{"line":1,"column":2516}},{"source":"content-handler.js","original":{"line":110,"column":14},"generated":{"line":1,"column":2537}},{"source":"content-handler.js","name":"watchForChanges","original":{"line":110,"column":19},"generated":{"line":1,"column":2542}},{"source":"content-handler.js","original":{"line":110,"column":35},"generated":{"line":1,"column":2558}},{"source":"content-handler.js","name":"getSongElement","original":{"line":110,"column":40},"generated":{"line":1,"column":2563}},{"source":"content-handler.js","original":{"line":110,"column":58},"generated":{"line":1,"column":2580}},{"source":"content-handler.js","name":"updateNowPlaying","original":{"line":111,"column":17},"generated":{"line":1,"column":2585}},{"source":"content-handler.js","name":"updateNowPlaying","original":{"line":111,"column":17},"generated":{"line":1,"column":2590}},{"source":"content-handler.js","original":{"line":111,"column":34},"generated":{"line":1,"column":2607}},{"source":"content-handler.js","name":"song","original":{"line":111,"column":35},"generated":{"line":1,"column":2608}},{"source":"content-handler.js","original":{"line":111,"column":41},"generated":{"line":1,"column":2613}},{"source":"content-handler.js","name":"getSong","original":{"line":111,"column":46},"generated":{"line":1,"column":2618}},{"source":"content-handler.js","original":{"line":113,"column":14},"generated":{"line":1,"column":2638}},{"source":"content-handler.js","name":"watchForChanges","original":{"line":113,"column":19},"generated":{"line":1,"column":2643}},{"source":"content-handler.js","original":{"line":113,"column":35},"generated":{"line":1,"column":2659}},{"source":"content-handler.js","name":"getArtistElement","original":{"line":113,"column":40},"generated":{"line":1,"column":2664}},{"source":"content-handler.js","original":{"line":113,"column":60},"generated":{"line":1,"column":2683}},{"source":"content-handler.js","name":"updateNowPlaying","original":{"line":114,"column":17},"generated":{"line":1,"column":2688}},{"source":"content-handler.js","name":"updateNowPlaying","original":{"line":114,"column":17},"generated":{"line":1,"column":2693}},{"source":"content-handler.js","original":{"line":114,"column":34},"generated":{"line":1,"column":2710}},{"source":"content-handler.js","name":"artist","original":{"line":114,"column":35},"generated":{"line":1,"column":2711}},{"source":"content-handler.js","original":{"line":114,"column":43},"generated":{"line":1,"column":2718}},{"source":"content-handler.js","name":"getArtist","original":{"line":114,"column":48},"generated":{"line":1,"column":2723}},{"source":"content-handler.js","original":{"line":117,"column":14},"generated":{"line":1,"column":2745}},{"source":"content-handler.js","name":"updateNowPlaying","original":{"line":117,"column":19},"generated":{"line":1,"column":2750}},{"source":"content-handler.js","name":"data","original":{"line":117,"column":36},"generated":{"line":1,"column":2767}},{"source":"content-handler.js","name":"console","original":{"line":119,"column":8},"generated":{"line":1,"column":2770}},{"source":"content-handler.js","name":"log","original":{"line":119,"column":16},"generated":{"line":1,"column":2778}},{"source":"content-handler.js","name":"config","original":{"line":119,"column":39},"generated":{"line":1,"column":2801}},{"source":"content-handler.js","name":"version","original":{"line":119,"column":46},"generated":{"line":1,"column":2803}},{"source":"content-handler.js","name":"version","original":{"line":119,"column":46},"generated":{"line":1,"column":2810}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":2829}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":2837}},{"source":"content-handler.js","original":{"line":7,"column":28},"generated":{"line":1,"column":2852}}],"sources":{"content-handler.js":"import {config} from \"../config\";\nimport * as firebase from \"firebase/app\";\nimport 'firebase/auth';\nimport 'firebase/firestore';\nimport {setStoredValue} from \"./utils\";\n\nexport class ContentHandler {\n\n    constructor() {\n        this.userId = undefined;\n        this.pendingUpdates = {};\n        this.updateTrigger = undefined;\n    }\n\n    async watchForChanges(element, callback) {\n        // Options for the observer (which mutations to observe)\n        const config = {attributes: true, characterData: true, childList: true, subtree: false};\n\n        // Create an observer instance linked to the callback function\n        const observer = new MutationObserver(function (mutationsList) {\n            // Use traditional 'for loops' for IE 11\n            for (let mutation of mutationsList) {\n                if (mutation.type === 'childList') {\n                    console.log('A child node has been added or removed.');\n                } else if (mutation.type === 'attributes') {\n                    console.log('The ' + mutation.attributeName + ' attribute was modified.');\n                    callback();\n                }\n            }\n        });\n\n        // Start observing the target node for configured mutations\n        observer.observe(element, config);\n\n        return () => {\n            observer.disconnect()\n        };\n    };\n\n    getCoverElement() {\n        return document.querySelector('.cover-art-image');\n    }\n\n    getSongElement() {\n        return document.querySelector('[data-testid=nowplaying-track-link]');\n    }\n\n    getArtistElement() {\n        return document.querySelector('a[href^=\"/artist\"]');\n    }\n\n    getCover() {\n        return this.getCoverElement().src;\n    }\n\n    getSong() {\n        return this.getSongElement().innerText;\n    }\n\n    getArtist() {\n        return this.getArtistElement().innerText;\n    }\n\n    async publishPendingUpdates() {\n        this.pendingUpdates.version = config.version;\n        this.pendingUpdates.date = firebase.firestore.Timestamp.now();\n        await firebase.firestore().collection(`users`).doc(this.userId).set(this.pendingUpdates, {merge: true});\n    }\n\n    updateNowPlaying(data) {\n        // Merge the changes\n        this.pendingUpdates = {...this.pendingUpdates, ...data};\n        if (this.updateTrigger) {\n            clearTimeout(this.updateTrigger);\n        }\n\n        this.updateTrigger = setTimeout(() => {\n            this.publishPendingUpdates();\n        }, config.debounceTime);\n    }\n\n    initFirebase() {\n        firebase.initializeApp(config.firebase);\n    };\n\n    async getCurrentUserId() {\n        const {user} = await firebase.auth().signInAnonymously();\n        return user.uid;\n    };\n\n    async run() {\n        this.initFirebase();\n        this.userId = await this.getCurrentUserId();\n\n        await setStoredValue({[config.storageKey]: this.userId});\n\n        console.log('Current user', this.userId);\n\n        const data = {\n            cover: this.getCover(),\n            song: this.getSong(),\n            artist: this.getArtist(),\n        };\n\n        console.log('Now playing', data);\n\n        await this.watchForChanges(this.getCoverElement(), () => {\n            this.updateNowPlaying({cover: this.getCover()});\n        });\n        await this.watchForChanges(this.getSongElement(), () => {\n            this.updateNowPlaying({song: this.getSong()});\n        });\n        await this.watchForChanges(this.getArtistElement(), () => {\n            this.updateNowPlaying({artist: this.getArtist()});\n        });\n\n        await this.updateNowPlaying(data);\n\n        console.log(`Spotify Watcher ${config.version} loaded`);\n    };\n}\n"},"lineCount":null}},"error":null,"hash":"590c0fbdb1de740ad69dae98cc65636b","cacheData":{"env":{}}}